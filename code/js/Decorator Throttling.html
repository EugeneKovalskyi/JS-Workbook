<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Тормозящий (throttling) декоратор</title>
  </head>
  <body>
    <p>
      Создайте «тормозящий» декоратор throttle(f, ms), который возвращает
      обёртку. При многократном вызове он передает вызов f не чаще одного раза в
      ms миллисекунд.
      <br />По сравнению с декоратором debounce поведение совершенно другое:
      <br />- debounce запускает функцию один раз после периода «бездействия». Подходит для обработки конечного результата. 
      <br />- throttle запускает функцию не чаще, чем указанное время ms. Подходит для регулярных обновлений, которые не должны быть слишком частыми.
    </p>

    <script>
      function foo(x) {
        console.log(x)
      }

      function throttle(func, ms) {
        let runIndicator = false
        let savedArgs = null
        let savedThis = null

        return function wrapper() {
          if (runIndicator) {
            savedArgs = arguments
            savedThis = this

            return
          }
          
          func.apply(this, arguments)
          runIndicator = true
          setTimeout(() => {
            runIndicator = false

            if (savedArgs) {
              wrapper.apply(savedThis, savedArgs)
              savedArgs = null
              savedThis = null
            }
          }, ms)
        }
      }

      const bar = throttle(foo, 1000)

      bar(1)
      bar(2)
      bar(3)
    </script>
  </body>
</html>
