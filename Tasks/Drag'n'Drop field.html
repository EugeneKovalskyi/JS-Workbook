<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Document</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
      }

      #field {
        background: url(https://js.cx/drag-heroes/field.png);
        width: 800px;
        height: 600px;
        float: left;
      }

      .hero {
        background: url(https://js.cx/drag-heroes/heroes.png);
        width: 130px;
        height: 128px;
        float: left;
      }

      #hero1 {
        background-position: 0 0;
      }

      #hero2 {
        background-position: 0 -128px;
      }

      #hero3 {
        background-position: -120px 0;
      }

      #hero4 {
        background-position: -125px -128px;
      }

      #hero5 {
        background-position: -248px -128px;
      }

      #hero6 {
        background-position: -244px 0;
      }

      .draggable {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h2>Расставьте супергероев по полю.</h2>

    <p>
      Супергерои и мяч - это элементы с классом "draggable". Сделайте так, чтобы
      их можно было переносить.
    </p>

    <p>
      Важно: ограничить перетаскивание границами окна. Если супергероя подносят
      к верхней или нижней границе страницы, она должна автоматически
      прокручиваться.
    </p>

    <p>
      Если страница помещается на вашем экране целиком и не имеет вертикальной
      прокрутки -- сделайте окно браузера меньше, чтобы протестировать эту
      возможность.
    </p>

    <p>
      В этой задаче достаточно справиться с вертикальной прокруткой. Обычно нет
      горизонтальной прокрутки, и она обрабатывается аналогичным образом, если
      это необходимо.
    </p>

    <p>
      Да, и ещё: супергерои ни при каких условиях не должны попасть за край
      экрана.
    </p>

    <div id="field"></div>

    <div
      class="hero draggable"
      id="hero1"
    ></div>
    <div
      class="hero draggable"
      id="hero2"
    ></div>
    <div
      class="hero draggable"
      id="hero3"
    ></div>
    <div
      class="hero draggable"
      id="hero4"
    ></div>
    <div
      class="hero draggable"
      id="hero5"
    ></div>
    <div
      class="hero draggable"
      id="hero6"
    ></div>

    <img
      src="https://en.js.cx/clipart/ball.svg"
      class="draggable"
    />

    <div style="clear: both"></div>

    <script>
      let shiftX = null
      let shiftY = null
      let mousedownTarget = null

      document.addEventListener('mousedown', (event) => {
        const target = event.target

        // Выключаем выделение элементов при нажатии ЛКМ и СКМ
        event.preventDefault()

        if (target.classList.contains('draggable')) {
          // Расстояние от курсора до крайней левой/верхней границы элемента
          shiftX = event.clientX - target.getBoundingClientRect().left
          shiftY = event.clientY - target.getBoundingClientRect().top

          // Стартовая позиция элемента относительно курсора
          target.style.position = 'absolute'
          target.style.zIndex = 1000
          target.style.left = event.pageX - shiftX + 'px'
          target.style.top = event.pageY - shiftY + 'px'

          mousedownTarget = target

          document.addEventListener('mousemove', mousemove)
          document.addEventListener('mouseup', mouseup)
        }
      })

      // Выключаем браузерный Drag'n'Drop
      document.ondragstart = () => false

      function mousemove(event) {
        // Отслеживать нужно элемент из события mousedown
        const target = mousedownTarget
        const clientWidth = document.documentElement.clientWidth
        const clientHeight = document.documentElement.clientHeight
        const scrollWidth = document.documentElement.scrollWidth
        const scrollHeight = document.documentElement.scrollHeight
        const scrollX = window.scrollX
        const scrollY = window.scrollY
        const right = clientWidth + scrollX - target.offsetWidth
        const bottom = clientHeight + scrollY - target.offsetHeight

        // Положение элемента относительно координат курсора в документе
        let left = event.pageX - shiftX
        let top = event.pageY - shiftY

        // Держать элемент всегда в левом/верхнем крайнем положении окна
        if (left < scrollX) left = scrollX
        if (top < scrollY) top = scrollY

        // Держать элемент всегда в правом/нижнем крайнем положении окна
        if (left + target.offsetWidth > clientWidth + scrollX) left = right
        if (top + target.offsetHeight > clientHeight + scrollY) top = bottom

        // При наличии скрола прокрутить страницу по горизонтали/вертикали
        if (left === right && scrollWidth > clientWidth)
          document.documentElement.scrollLeft += 10
        if (left === scrollX && scrollWidth > clientWidth)
          document.documentElement.scrollLeft -= 10
        if (top === bottom && scrollHeight > clientHeight)
          document.documentElement.scrollTop += 10
        if (top === scrollY && scrollHeight > clientHeight)
          document.documentElement.scrollTop -= 10

        target.style.left = left + 'px'
        target.style.top = top + 'px'
      }

      function mouseup() {
        document.removeEventListener('mousemove', mousemove)
        document.removeEventListener('mouseup', mouseup)
      }
    </script>
  </body>
</html>
